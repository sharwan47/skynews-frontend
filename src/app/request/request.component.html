<div class="card">
  <div class="card-body">
    <h5 class="text-center m-auto mb-2">
      <ng-container *ngIf="bookingId; else noBookingId">
        Copy Request ID: <span [class]="cssClass">{{ bookingId }}</span>
      </ng-container>
    </h5>
    
    <ng-template #noBookingId>
      <h5 class="text-center m-auto mb-2">
        My Request
      </h5>
    </ng-template>
    
    <ng-stepper
      #cdkStepper
      [linear]="true"
      (selectionChange)="selectionChanged($event)"
    >
      <cdk-step [optional]="false" [stepControl]="requestForm" #informationStep>
        <ng-template cdkStepLabel>
          <div class="step-bullet">
            <i class="bi bi-clipboard"></i>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              *ngIf="informationStep.completed"
              class="bi bi-check-circle icon"
              viewBox="0 0 16 16"
            >
              <path
                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"
              />
              <path
                d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"
              />
            </svg>
          </div>
          <div class="step-title">
            Information<span class="text-danger">*</span>
          </div>
        </ng-template>
        <div class="px-md-5">
          <hr />
          <div class="row">
            <div class="col-md-12">
              <nav id="request_types">
                <div
                  class="nav justify-content-md-evenly"
                  id="nav-tab"
                  role="tablist"
                >
                  <div
                    class="form-check form-check-inline d-flex active"
                    data-toggle="form"
                  >
                    <input
                      type="radio"
                      class="form-check-input fs-4"
                      id="live"
                      value="live"
                      [name]="requestTypeGroupName"
                      [(ngModel)]="requestType"
                      (ngModelChange)="changeRequestType($event)"
                    />
                    <label for="live" class="align-self-end px-3">Live</label>
                  </div>
                  <div
                    class="form-check form-check-inline d-flex"
                    data-toggle="form"
                  >
                    <input
                      type="radio"
                      class="form-check-input fs-4"
                      id="prerecorded"
                      value="prerecorded"
                      [name]="requestTypeGroupName"
                      [(ngModel)]="requestType"
                      (ngModelChange)="changeRequestType($event)"
                    />
                    <label for="prerecorded" class="align-self-end px-3"
                      >Pre-record</label
                    >
                  </div>
                  <div
                    class="form-check form-check-inline d-flex"
                    data-toggle="form"
                  >
                    <input
                      type="radio"
                      class="form-check-input fs-4"
                      id="cameraman"
                      value="cameraman"
                      [name]="requestTypeGroupName"
                      [(ngModel)]="requestType"
                      (ngModelChange)="changeRequestType($event)"
                    />
                    <label for="cameraman" class="align-self-end px-3"
                      >Camera Crew</label
                    >
                  </div>
                </div>
              </nav>
            </div>
          </div>

          <div class="pt-3">
            <form
              [formGroup]="requestForm"
              #formRef="ngForm"
              novalidate
              (ngSubmit)="formSubmit()"
            >
              <div class="row">
                <div class="col-md-12">
                  <div class="row">
                    <div class="col-lg-6">
                      <div class="row">
                        <div class="col-8 py-2">
                          <label
                            for="fromDateTime"
                            class="form-label d-block fw-bold"
                            >From Date<span class="text-danger">*</span>
                            <div
                              class="form-check form-check-inline m-0 float-end"
                              (change)="eventTypeChange($event)"
                            >
                              <input
                                class="form-check-input"
                                formControlName="recurring"
                                type="checkbox"
                                id="recurring"
                                value="option1"
                              />
                              <label class="form-check-label" for="recurring"
                                >Recurring</label
                              >
                            </div>
                            <span
                              *ngIf="requestForm.hasError('previousDate')"
                              class="badge me-1 float-end bg-warning bg-opacity-25 text-black border"
                            >
                              <small> {{ dateValidationMsg }} </small>
                            </span>
                          </label>
                          <div>
                            <div class="form-group">
                              <input
                                class="form-control"
                                placeholder="yyyy-mm-dd"
                                name="dp"
                                formControlName="fromDateTime"
                                ngbDatepicker
                                autocomplete="off"
                                (click)="d.toggle()"
                                #d="ngbDatepicker"
                                [markDisabled]="isDisabled"
                              />

                              <!-- <div
                            class=" calendar"
                            (click)="d.toggle()"
                            type="button"
                          >
                            <i class="bi bi-calendar"></i>
                          </div> -->
                            </div>
                          </div>

                          <small
                            class="text-danger"
                            *ngIf="
                              formRef.submitted &&
                              requestForm
                                .get('fromDateTime')
                                ?.hasError('required')
                            "
                            >Date is required</small
                          >
                        </div>
                        <div class="col-4 py-2 justify-content-between d-flex">
                          <div></div>
                          <div>
                            <label
                              for="startDateTime"
                              class="form-label fw-bold"
                              >From<span class="text-danger">*</span></label
                            >
                            <!-- <input
                        type="time"
                        formControlName="startDateTime"
                        format="24"
                        class="form-control"
                        id="startDateTime"
                        required
                      /> -->
                            <ngb-timepicker
                              formControlName="startDateTime"
                              [spinners]="false"
                              [meridian]="false" 
                              (change)="resetTimeForParticipant()"                          
                              
                            >
                            </ngb-timepicker>
                            <small
                              class="text-danger"
                              *ngIf="
                                formRef.submitted &&
                                requestForm
                                  .get('startDateTime')
                                  ?.hasError('required')
                              "
                              >Start date is required</small
                            >
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="col-lg-6">
                      <div class="row">
                        <div class="col-8 py-2">
                          <label
                            for="toDateTime"
                            class="form-label d-block fw-bold"
                            >To Date<span class="text-danger">*</span>
                            <span
                              *ngIf="requestForm.hasError('previousDate')"
                              class="badge me-1 float-end bg-warning bg-opacity-25 text-black border"
                            >
                              <small> {{ dateValidationMsg }} </small>
                            </span>
                          </label>
                          <div>
                            <div class="form-group">
                              <input
                                class="form-control"
                                placeholder="yyyy-mm-dd"
                                name="dp"
                                formControlName="toDateTime"
                                ngbDatepicker
                                autocomplete="off"
                                (click)="d1.toggle()"
                                #d1="ngbDatepicker"
                                [markDisabled]="isDisabled"
                              />

                              <!-- <div
                            class=" calendar"
                            (click)="d.toggle()"
                            type="button"
                          >
                            <i class="bi bi-calendar"></i>
                          </div> -->
                            </div>
                          </div>

                          <small
                            class="text-danger"
                            *ngIf="
                              formRef.submitted &&
                              requestForm
                                .get('toDateTime')
                                ?.hasError('required')
                            "
                            >Date is required</small
                          >
                        </div>
                        <div class="col-4 py-2 justify-content-between d-flex">
                          <div></div>
                          <div>
                            <label for="endDateTime" class="form-label fw-bold"
                              >To<span class="text-danger">*</span></label
                            >
                            <!-- <input
                        type="time"
                        formControlName="endDateTime"
                        class="form-control"
                        id="endDateTime"
                        required
                      /> -->
                            <ngb-timepicker
                              formControlName="endDateTime"
                              [spinners]="false"
                              [meridian]="false"
                              (change)="resetTimeForParticipant()"
                            >
                            </ngb-timepicker>
                            <small
                              class="text-danger"
                              *ngIf="
                                formRef.submitted &&
                                requestForm
                                  .get('endDateTime')
                                  ?.hasError('required')
                              "
                              >End time is required</small
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-12">
                  <div
                    #collapse="ngbCollapse"
                    [(ngbCollapse)]="isRecurringCollapsed"
                  >
                    <div class="card border">
                      <div class="card-header">
                        <strong> Recurring event details </strong>
                      </div>
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-2">
                            <div class="pb-2">
                              <span>Recurrence pattern</span>
                              <small
                                class="text-danger d-block"
                                *ngIf="
                                  formRef.submitted &&
                                  requestForm
                                    .get('pattern')
                                    ?.hasError('required')
                                "
                                >Pattern is required</small
                              >
                            </div>
                            <div>
                              <div class="form-check">
                                <input
                                  class="form-check-input"
                                  type="radio"
                                  (change)="onPatternChange($event, 'day')"
                                  formControlName="pattern"
                                  id="daily"
                                  value="daily"
                                  checked
                                />
                                <label class="form-check-label" for="daily">
                                  Daily
                                </label>
                              </div>
                              <div class="form-check">
                                <input
                                  class="form-check-input"
                                  type="radio"
                                  (change)="onPatternChange($event, 'week')"
                                  formControlName="pattern"
                                  id="weekly"
                                  value="weekly"
                                />
                                <label class="form-check-label" for="weekly">
                                  Weekly
                                </label>
                              </div>
                              <div class="form-check">
                                <input
                                  class="form-check-input"
                                  type="radio"
                                  (change)="onPatternChange($event, 'month')"
                                  formControlName="pattern"
                                  id="monthly"
                                  value="monthly"
                                />
                                <label class="form-check-label" for="monthly">
                                  Monthly
                                </label>
                              </div>
                              <!-- <div class="form-check">
                        <input class="form-check-input" type="radio" (change)="onPatternChange($event, 'year')" formControlName="pattern" id="yearly" value="optyearlyion3">
                        <label class="form-check-label" for="yearly">
                          Yearly
                        </label>
                      </div> -->
                            </div>
                          </div>
                          <div
                            class="col-md-5"
                            *ngIf="requestForm.controls['recurring'].value"
                          >
                            <div *ngIf="pattern">
                              <div class="pb-2">
                                <span>Recur in every </span>
                                <span class="px-1">
                                  <input
                                    type="number"
                                    (wheel)="(false)"
                                    class="rounded-2 border-1 text-center"
                                    formControlName="patternValue"
                                    style="max-width: 2rem; padding: 2px"
                                  />
                                </span>
                                <span>
                                  {{ pattern }}(s)
                                  <span *ngIf="pattern != 'day'">
                                    in the following days</span
                                  >
                                </span>
                              </div>
                              <small
                                class="text-danger d-block"
                                *ngIf="
                                  formRef.submitted &&
                                  requestForm
                                    .get('patternValue')
                                    ?.hasError('required')
                                "
                                >Pattern value is required</small
                              >
                              <small
                                class="text-danger d-block"
                                *ngIf="
                                  formRef.submitted &&
                                  requestForm
                                    .get('patternValue')
                                    ?.hasError('pattern')
                                "
                                >Pattern value is invalid</small
                              >
                            </div>

                            <div *ngIf="pattern == 'week'">
                              <div class="form-check form-check-inline">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  (change)="onRecurrenceValueChange($event)"
                                  id="inlineCheckbox1"
                                  value="1"
                                />
                                <label
                                  class="form-check-label"
                                  for="inlineCheckbox1"
                                  >Monday</label
                                >
                              </div>
                              <div class="form-check form-check-inline">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  (change)="onRecurrenceValueChange($event)"
                                  id="inlineCheckbox2"
                                  value="2"
                                />
                                <label
                                  class="form-check-label"
                                  for="inlineCheckbox2"
                                  >Tuesday</label
                                >
                              </div>
                              <div class="form-check form-check-inline">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  (change)="onRecurrenceValueChange($event)"
                                  id="inlineCheckbox3"
                                  value="3"
                                />
                                <label
                                  class="form-check-label"
                                  for="inlineCheckbox3"
                                  >Wednesday</label
                                >
                              </div>
                              <div class="form-check form-check-inline">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  (change)="onRecurrenceValueChange($event)"
                                  id="inlineCheckbox4"
                                  value="4"
                                />
                                <label
                                  class="form-check-label"
                                  for="inlineCheckbox4"
                                  >Thursday</label
                                >
                              </div>
                              <div class="form-check form-check-inline">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  (change)="onRecurrenceValueChange($event)"
                                  id="inlineCheckbox5"
                                  value="5"
                                />
                                <label
                                  class="form-check-label"
                                  for="inlineCheckbox5"
                                  >Friday</label
                                >
                              </div>
                              <div class="form-check form-check-inline">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  (change)="onRecurrenceValueChange($event)"
                                  id="inlineCheckbox6"
                                  value="6"
                                />
                                <label
                                  class="form-check-label"
                                  for="inlineCheckbox6"
                                  >Saturday</label
                                >
                              </div>
                              <div class="form-check form-check-inline">
                                <input
                                  class="form-check-input"
                                  type="checkbox"
                                  (change)="onRecurrenceValueChange($event)"
                                  id="inlineCheckbox7"
                                  value="0"
                                />
                                <label
                                  class="form-check-label"
                                  for="inlineCheckbox7"
                                  >Sunday</label
                                >
                              </div>
                            </div>

                            <div class="py-2" *ngIf="pattern == 'month'">
                              <div
                                class="form-check form-check-inline"
                                *ngFor="let i of monthDays"
                              >
                                <input
                                  class="form-check-input"
                                  (change)="onRecurrenceValueChange($event)"
                                  type="checkbox"
                                  id="inlineCheckbox8"
                                  [value]="i + 1"
                                />
                                <label
                                  class="form-check-label"
                                  for="inlineCheckbox8"
                                  >{{ i + 1 }}</label
                                >
                              </div>
                              <div class="mt-1">
                                <small>
                                  <div>
                                    <strong>Heads Up!</strong>
                                  </div>
                                  <div>
                                    <strong
                                      >April, June, September, and
                                      November</strong
                                    >
                                    are <strong>30</strong> days long and
                                    February is only <strong>28</strong> days
                                    long.
                                  </div>
                                  <div>
                                    Some dates may be reduced to one day before
                                    that, if it does not exist. For example June
                                    31 will be reduced to June 30.
                                  </div>
                                </small>
                              </div>
                            </div>

                            <small
                              class="text-danger d-block"
                              *ngIf="
                                formRef.submitted &&
                                requestForm
                                  .get('recurrenceValue')
                                  ?.hasError('required')
                              "
                              >Recurrence Value is required</small
                            >
                          </div>
                          <div class="col-md-5" *ngIf="pattern">
                            <div class="pb-2">
                              <span>Range of recurrence</span>
                              <small
                                class="text-danger d-block"
                                *ngIf="
                                  formRef.submitted &&
                                  requestForm
                                    .get('requestEndCriteria')
                                    ?.hasError('required')
                                "
                                >Range is required</small
                              >
                            </div>
                            <div class="row pb-2">
                              <div class="col-md-4">
                                <div class="form-check">
                                  <input
                                    class="form-check-input"
                                    type="radio"
                                    (change)="onRequestEndCrtChange($event)"
                                    formControlName="requestEndCriteria"
                                    id="exampleRadios1"
                                    value="date"
                                  />
                                  <label
                                    class="form-check-label"
                                    for="exampleRadios1"
                                  >
                                    End Date
                                  </label>
                                </div>
                              </div>
                              <div class="col-md-8">
                                <div class="form-group">
                                  <input
                                    class="form-control py-0"
                                    formControlName="requestEndDateTime"
                                    placeholder="yyyy-mm-dd"
                                    name="dp"
                                    ngbDatepicker
                                    autocomplete="off"
                                    (click)="de.toggle()"
                                    #de="ngbDatepicker"
                                    [markDisabled]="isDisabled"
                                  />
                                </div>
                                <small
                                  class="text-danger"
                                  *ngIf="
                                    formRef.submitted &&
                                    requestForm
                                      .get('requestEndDateTime')
                                      ?.hasError('required')
                                  "
                                  >Request End Datetime is required</small
                                >
                              </div>
                            </div>
                            <div class="row">
                              <div class="col-md-4">
                                <div class="form-check">
                                  <input
                                    class="form-check-input"
                                    type="radio"
                                    (change)="onRequestEndCrtChange($event)"
                                    formControlName="requestEndCriteria"
                                    id="exampleRadios1"
                                    value="occurrence"
                                  />
                                  <label
                                    class="form-check-label"
                                    for="exampleRadios1"
                                  >
                                    End After
                                  </label>
                                </div>
                              </div>
                              <div class="col-md-4">
                                <input
                                  type="text"
                                  formControlName="occurrenceTurns"
                                  class="form-control"
                                />
                                <small
                                  class="text-danger d-block"
                                  *ngIf="
                                    formRef.submitted &&
                                    requestForm
                                      .get('occurrenceTurns')
                                      ?.hasError('required')
                                  "
                                  >Occurrence Turns is required</small
                                >
                              </div>
                              <div class="col-md-4 d-flex">
                                <span class="align-self-center"
                                  >occurrences</span
                                >
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div
                  class="col-md-6 py-2"
                  *ngIf="
                    requestType == 'live' ||
                    requestType == 'prerecorded' ||
                    requestType == 'remote'
                  "
                >
                  <label for="name" class="form-label fw-bold"
                    >{{
                      requestType == 'live' || requestType == 'prerecorded'
                        ? 'Booking Name'
                        : 'Individual'
                    }}<span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    formControlName="name"
                    class="form-control"
                    id="name"
                    required
                  />
                  <small
                    class="text-danger"
                    *ngIf="
                      formRef.submitted &&
                      requestForm.get('name')?.hasError('required')
                    "
                    >Name is required</small
                  >
                </div>

                <div class="col-md-3 py-2" *ngIf="requestType == 'prerecorded'">
                  <label for="inputResourceType" class="form-label fw-bold"
                    >Resource Type<span class="text-danger">*</span></label
                  >
                  <ng-select
                    [items]="resourceTypes"
                    bindLabel="name"
                    bindValue="_id"
                    formControlName="resourceType"
                    (change)="resourceChange($event)"
                  >
                  </ng-select>
                  <small
                    class="text-danger"
                    *ngIf="
                      formRef.submitted &&
                      requestForm.get('resourceType')?.hasError('required')
                    "
                    >Resource Type is required</small
                  >
                </div>
                <div class="col-md-3 py-2" *ngIf="requestType == 'prerecorded'">
                  <div class="d-flex justify-content-between">
                    <label for="inputResourceName" class="form-label fw-bold" style="width: 48%;"
                      >Resource Name<span class="text-danger">*</span></label
                    >
                    <span >

                      <button type="button" class="btn btn-primary btn-sm text-white btnCss bgBlue" (click)="showResourceOwnerShipModal()" title="View resource ownership" ><span>Owner</span></button>
                      <button type="button" class="btn btn-success btn-sm text-white btnCss mx-2" (click)="showResourceModal()" title="View resource time matrix" ><span>View</span></button>
                    </span>
                   </div>
                  <ng-select
                    [items]="resources$ | async"
                    bindLabel="name"
                    bindValue="_id"
                    formControlName="resourceName"
                    (change)="prerecordnamechange($event)"
                  >
                  </ng-select>
                  <small
                    class="text-danger"
                    *ngIf="
                      formRef.submitted &&
                      requestForm.get('resourceName')?.hasError('required')
                    "
                    >Resource Name is required</small
                  >
                </div>
                <div class="col-md-2 py-2" *ngIf="requestType == 'live'">
                  <label for="inputChannel" class="form-label fw-bold"
                    >Channel<span class="text-danger">*</span></label
                  >
                  <ng-select
                    [items]="channels$ | async"
                    bindLabel="name"
                    bindValue="_id"
                    formControlName="channel"
                  >
                  </ng-select>
                  <small
                    class="text-danger"
                    *ngIf="
                      formRef.submitted &&
                      requestForm.get('channel')?.hasError('required')
                    "
                    >Channel is required</small
                  >
                </div>
                <div class="col-md-2 py-2" *ngIf="requestType == 'live'">
                  <label for="inputShootType" class="form-label fw-bold"
                    >Resource Type<span class="text-danger">*</span></label
                  >
                  <ng-select
                    [items]="resourceTypes"
                    bindLabel="name"
                    bindValue="_id"
                    formControlName="resourceType"
                    (change)="resourceChange($event)"
                  >
                  </ng-select>
                  <small
                    class="text-danger"
                    *ngIf="
                      formRef.submitted &&
                      requestForm.get('resourceType')?.hasError('required')
                    "
                    >Resource Type is required</small
                  >
                </div>
                <div class="col-md-2 py-2" *ngIf="requestType == 'live'">
                  <div class="d-flex justify-content-between">
                    <label for="inputResourceName" class="form-label fw-bold" style="width: 48%;"
                      >Resource Name<span class="text-danger">*</span></label
                    >
                    <span>

                      <button type="button" class="btn btn-primary btn-sm text-white btnCss bgBlue" (click)="showResourceOwnerShipModal()" title="View resource ownership"><span>Owner</span></button>
                      <button type="button" class="btn btn-success btn-sm text-white btnCss mx-2" (click)="showResourceModal()" title="View resource time matrix"  ><span>View</span></button>
                    </span> 
                   </div>
                  <ng-select
                    [items]="resources$ | async"
                    bindLabel="name"
                    bindValue="_id"
                    formControlName="resourceName"
                    (change)="livenamechange($event)"
                  >
                  </ng-select>
                  <small
                    class="text-danger"
                    *ngIf="
                      formRef.submitted &&
                      requestForm.get('resourceName')?.hasError('required')
                    "
                    >Resource Name is required</small
                  >
                </div>

                <!-- Cameraman related fields -->
                <div *ngIf="requestType == 'cameraman'">
                  <div class="row">
                    <div class="col-md-6 py-2">
                      <label for="name" class="form-label fw-bold"
                        >Booking Name<span class="text-danger">*</span></label
                      >
                      <input
                        type="text"
                        formControlName="name"
                        class="form-control"
                        id="name"
                        required
                      />
                      <small
                        class="text-danger"
                        *ngIf="
                          formRef.submitted &&
                          requestForm.get('name')?.hasError('required')
                        "
                        >Name is required</small
                      >
                    </div>
                    <div
                      class="col-md-2 py-2"
                      *ngIf="requestType == 'cameraman'"
                    >
                      <label for="inputResourceType" class="form-label fw-bold"
                        >Shoot Type<span class="text-danger">*</span></label
                      >
                      <ng-select
                        [items]="gShootTypes"
                        bindLabel="name"
                        bindValue="_id"
                        formControlName="shootType"
                      >
                      </ng-select>
                      <small
                        class="text-danger"
                        *ngIf="
                          formRef.submitted &&
                          requestForm.get('shootType')?.hasError('required')
                        "
                        >Shoot Type is required</small
                      >
                    </div>
                    <div
                      class="col-md-2 py-2"
                      *ngIf="requestType == 'cameraman'"
                    >
                      <label for="inputResourceType" class="form-label fw-bold"
                        >Resource Type<span class="text-danger">*</span></label
                      >
                      <ng-select
                        [items]="resourceTypes"
                        bindLabel="name"
                        bindValue="_id"
                        formControlName="resourceType"
                        (change)="resourceChange($event)"
                      >
                      </ng-select>
                      <small
                        class="text-danger"
                        *ngIf="
                          formRef.submitted &&
                          requestForm.get('resourceType')?.hasError('required')
                        "
                        >Resource Type is required</small
                      >
                    </div>
                    <div
                      class="col-md-2 py-2"
                      *ngIf="requestType == 'cameraman'"
                    >
                      <div class="d-flex justify-content-between">
                        <label
                          for="inputResourceName"
                          class="form-label fw-bold" style="width: 48%;"
                          >Resource Name<span class="text-danger"
                            >*</span
                          ></label
                        >
                        <span>
                          <button type="button" class="btn btn-primary btn-sm text-white btnCss bgBlue" (click)="showResourceOwnerShipModal()" title="View resource ownership" ><span>Owner</span></button>
                          <button type="button" class="btn btn-success btn-sm text-white btnCss mx-2" (click)="showResourceModal()" title="View resource time matrix" ><span>View</span></button>
                        </span>
                      </div>
                      <ng-select
                        [items]="resources$ | async"
                        bindLabel="name"
                        bindValue="_id"
                        formControlName="resourceName"
                        (change)="cameramannamechange($event)"
                      >
                      </ng-select>
                      <small
                        class="text-danger"
                        *ngIf="
                          formRef.submitted &&
                          requestForm.get('resourceName')?.hasError('required')
                        "
                        >Resource Name is required</small
                      >
                    </div>
                  </div>
                </div>

                <!-- Pre recorded -->
                <ng-container formArrayName="participants">
                  <div
                    *ngIf="
                      requestType == 'prerecorded' || requestType == 'live'
                    "
                  >
                    <div class="row">
                      <div
                        *ngFor="
                          let participant of participants.controls;
                          let i = index
                        "
                      >
                        <ng-container *ngIf="i == 0" [formGroupName]="i">
                          <div class="row">
                            <div class="col-md-6 py-2">
                              <div class="form-group">
                                <div class="d-flex justify-content-between">
                                  <label
                                    for="hoststudio"
                                    class="form-label fw-bold"
                                  >
                                    Host</label
                                  >
                                </div>
                                <ng-select
                                  [items]="studios$ | async"
                                  bindLabel="name"
                                  bindValue="_id"
                                  formControlName="studio"
                                  (focus)="Handlefocus()"
                                  (change)="handleHostStudioChange($event,i)"
                                >
                                </ng-select>
                                <small
                                  class="text-danger"
                                  *ngIf="
                                    formRef.submitted &&
                                    participants.controls[i]
                                      .get('studio')
                                      ?.hasError('required')
                                  "
                                  >Studio is required</small
                                >
                              </div>
                            </div>
                            <div class="col-md-6 py-2">
                              <label for="host" class="form-label fw-bold"
                                >Host Name<span class="text-danger" *ngIf="showAsteriskElementHost">*</span></label
                              >
                              <input
                                type="text"
                                formControlName="name"
                                class="form-control"
                                id="host"
                                (focus)="Handlefocus()"
                              
                              />
                              <small
                                class="text-danger"
                                *ngIf="
                                  formRef.submitted &&
                                  participants.controls[i]
                                    .get('name')
                                    ?.hasError('required')
                                "
                                >Host Name is required</small
                              >
                            </div>
                          </div>
                        </ng-container>
                        <div
                          class="col-md-12"
                          id="guestwrapper"
                          [formGroupName]="i"
                          *ngIf="i > 0"
                        >
                          <div class="row" id="guestblueprint">
                            <div class="col-md-6 py-2">
                              <div class="form-group">
                                <label
                                  for="gueststudio_0"
                                  class="form-label fw-bold"
                                  >Guest</label
                                >

                                <ng-select
                                  [items]="studios$ | async"
                                  bindLabel="name"
                                  bindValue="_id"
                                  formControlName="studio"
                                  (focus)="Handlefocus()"
                                  (change)="
                                    handleParticipantStudioChange($event, i)
                                  "
                                >
                                </ng-select>
                              </div>
                            </div>
                            <div
                              class="py-2"
                              [ngClass]="{
                                'col-md-5': i > 1,
                                'col-md-6': !(i > 1)
                              }"
                            >
                              <label for="host" class="form-label fw-bold"
                                >Guest Name<span class="text-danger" *ngIf="isGuestSelected(i)">*</span> <button type="button" class="btn btn-warning btn-sm guestBtnColor text-white mx-1 btnCss " (click)="setGuestTimeRange()" ><span>Set Time</span></button></label
                              >
                              <input
                                type="text"
                                formControlName="name"
                                (focus)="Handlefocus()"
                                [value]=""
                                class="form-control"
                                [id]="'guest_' + i"
                              />
                            </div>
                            <div class="col-md-1 py-2 mt-2" *ngIf="i > 1">
                              <div class="form-group">
                                <label for=""> </label>
                                <div
                                  class="remove-guest"
                                  id="removeguest"
                                  (click)="removeGuest(i)"
                                >
                                  <button
                                    type="button"
                                    class="btn btn-danger float-end"
                                  >
                                    <i class="bi bi-trash"> </i>
                                  </button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-12">
                        <div class="d-grid gap-2 mt-2 py-2">
                          <button
                            type="button"
                            class="btn btn-primary"
                            (click)="addGuest()"
                          >
                            <i class="bi bi-plus-lg"></i>
                            Add Guest
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>

                <div class="">
                  <div class="col-md-12 py-2">
                    <label for="details" class="fw-bold"
                      >Details<span class="text-danger">*</span></label
                    >
                    <textarea
                      formControlName="details"
                      id="details"
                      class="form-control"
                      rows="10"
                      required
                    ></textarea>
                    <small
                      class="text-danger"
                      *ngIf="
                        formRef.submitted &&
                        requestForm.get('details')?.hasError('required')
                      "
                      >Details is required</small
                    >
                  </div>
                </div>

                <div class="d-flex">
                  <div class="py-2">
                    <div class="form-group">
                      <div>
                        <label for="attachment" class="form-label fw-bold"
                          >Attachment</label
                        >
                        <i
                          role="button"
                          (click)="removeAttachment($event)"
                          id="remove_attachment"
                          *ngIf="attachmentSet"
                          class="float-end bi bi-trash"
                        >
                        </i>
                      </div>
                      <input
                        type="file"
                        formControlName="attachment"
                        class="form-contorl d-none"
                        id="attachment"
                        #attachment
                        (change)="onAttachmentSelected($event)"
                      />
                      <div>
                        <div
                          (click)="attachment.click()"
                          role="button"
                          class="text-center bg-main-color border d-inline-block p-5 rounded-3 cursor-pointer"
                        >
                          <i class="bi bi-file-earmark-plus"></i>
                          <p class="mt-2" id="attachment_name">
                            {{ attachmentName }}
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="stepper-actions pt-3 text-center">
                <button
                  class="btn btn-primary btn-lg"
                  (click)="handleClickNext()"
                  [disabled]="!requestForm.valid"
                >
                  <span class="mx-3"> Next </span>
                </button>
                <!-- <button
                  class="btn btn-primary btn-lg"
                  cdkStepperNext
                  [disabled]="!requestForm.valid"
                >
                  <span class="mx-3"> Next </span>
                </button> -->
              </div>
            </form>
          </div>
        </div>
      </cdk-step>

      <cdk-step [optional]="false" #availabilityStep>
        <ng-template cdkStepLabel>
          <div class="step-bullet">
            <i class="bi bi-clock"></i>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              *ngIf="availabilityStep.completed"
              class="bi bi-check-circle icon"
              viewBox="0 0 16 16"
            >
              <path
                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"
              />
              <path
                d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"
              />
            </svg>
          </div>
          <div class="step-title">Availability</div>
        </ng-template>
        <div>
          <ngb-alert
            type="warning"
            [dismissible]="false"
            *ngIf="!allSlotsAvailable && !processing"
          >
            <span class="badge bg-warning bg-opacity-25 text-black me-2 p-2"
              ><strong>REJECTED</strong></span
            >
            The timeslots selected is/are not available due to the following
            events or schedules booked in it/them
          </ngb-alert>
          <div class="py-3">
            <div
              *ngFor="let request of requestTimeSlots"
              class="bg-light card mb-3"
            >
              <app-request-availability
                [request]="request"
                [eventType]="
                  requestForm.controls['recurring'].value
                    ? 'recurring'
                    : 'single'
                "
                (timeSlotChanged)="onRequestTimeSlotChanged($event)"
              >
              </app-request-availability>
            </div>
            <div
              *ngFor="let request of guestTimeSlots"
              class="bg-light card mb-3"
            >
              <app-request-availability
                [request]="request"
                [eventType]="
                  requestForm.controls['recurring'].value
                    ? 'recurring'
                    : 'single'
                "
                (timeSlotChanged)="onGuestTimeSlotChanged($event)"
              >
              </app-request-availability>
            </div>
          </div>
          <div class="stepper-actions pt-3 text-center">
            <button
              class="btn btn-outline-secondary btn-lg"
              (click)="goToFirstStep()"
            >
              <span class="mx-3"> Previous </span>
            </button>
            <button
              *ngIf="allSlotsAvailable"
              class="mx-2 btn btn-primary btn-lg"
              (click)="goToFinalStep()"
            >
              <span class="mx-3"> Next </span>
            </button>
            <button
              class="mx-2 btn btn-success btn-lg text-white"
              *ngIf="
                !allSlotsAvailable 
              "
              (click)="saveAvailable()"
              [disabled]="noSlotAvailable"
            >
              <span class="mx-3"> Save Available </span>
            </button>
          </div>
        </div>
      </cdk-step>

      <cdk-step [optional]="true">
        <ng-template cdkStepLabel>
          <div class="step-bullet">
            <i class="bi bi-flag"></i>
          </div>
          <div class="step-title">Finish</div>
        </ng-template>
        <div>
          <div>
            <ngb-alert type="success" [dismissible]="false">
              <span class="badge bg-success bg-opacity-25 me-2 p-2"
                ><strong>AVAILABLE</strong></span
              >
              The requested time slot is available please press the submit
              button to book the request
            </ngb-alert>
          </div>
          <div class="p-3 rounded border bg-main-color" *ngIf="requestObject">
            <table class="my-4">
              <ng-container>
                <tr *ngIf="requestObject.shootTypeName">
                  <td class="fw-bold py-2">ResourceName</td>
                  <td class="ms-4 py-2">{{ requestObject.shootTypeName }}</td>
                </tr>
                <tr *ngIf="requestObject._resourceType">
                  <td class="fw-bold py-2 pe-2">ResourceType</td>
                  <td class="ms-4 py-2">{{ requestObject._resourceType }}</td>
                </tr>
              </ng-container>
              <ng-container *ngIf="requestType == 'live'">
                <tr *ngIf="requestObject.channel">
                  <td class="fw-bold py-2">Channel</td>
                  <td class="ms-4 py-2">{{ requestObject.channelName }}</td>
                </tr>
                <tr *ngIf="requestObject.studio">
                  <td class="fw-bold py-2 pe-2">Studio</td>
                  <td class="ms-4 py-2">{{ requestObject.studioName }}</td>
                </tr>
              </ng-container>
              <tr *ngIf="requestObject.name">
                <td class="fw-bold py-2 pe-2">Booking Name</td>
                <td class="ms-4 py-2">{{ requestObject.name }}</td>
              </tr>
              <ng-container *ngIf="requestType == 'prerecorded'">
                <tr>
                  <td class="fw-bold py-2 pe-2">Control Room</td>
                  <td class="ms-4 py-2">{{ requestObject.controlRoomName }}</td>
                </tr>
              </ng-container>
              <tr
                *ngIf="
                  (requestType == 'prerecorded' || requestType == 'live') &&
                  requestObject.participants.length > 0
                "
              >
                <td class="fw-bold py-2 pe-2 align-baseline">Participants</td>
                <td class="ms-4 py-2 align-baseline">
                  <div
                    *ngFor="let participant of requestObject.participants"
                    class="pb-1"
                  >
                    <span>Name: {{ participant.name }}</span>
                    <span class="mx-2"
                      >Studio: {{ participant.studioName }}</span
                    >
                    <span class="text-capitalize"
                      >Type: {{ participant.type }}</span
                    >
                  </div>
                </td>
              </tr>
              <tr>
                <td class="fw-bold py-2 pe-2" style="vertical-align: text-top;">Details</td>
                <td class="ms-4 py-2"  [innerHTML]="requestObject.details"></td>
              </tr>
              <tr *ngIf="requestObject.gshootTypeName">
                <td class="fw-bold py-2 pe-2">ShootType</td>
                <td class="ms-4 py-2">{{ requestObject.gshootTypeName }}</td>
              </tr>
              <tr *ngIf="requestObject.fileName">
                <td class="fw-bold py-2 pe-2">Attachments</td>
                <td class="ms-4 py-2">{{ requestObject.fileName }}</td>
              </tr>
            </table>

            <div>
              <h4>Time slot(s)</h4>
              <div class="row">
                <div
                  class="col-md-12 pb-2"
                  *ngFor="let rts of requestObject.requestTimeSlots"
                >
                  <span
                    >{{
                      rts.startDateTime | date : 'EEEE, MMMM d, y, hh:mm:ss a'
                    }}
                    to {{ rts.endDateTime | date : 'MMMM d, hh:mm:ss a' }}</span
                  >
                </div>
              </div>
            </div>
          </div>
          <div class="stepper-actions pt-3 text-center">
            <button
              class="btn btn-outline-secondary mx-2 btn-lg"
              (click)="callPrevious()"
            >
              <span class="mx-3"> Previous </span>
            </button>
            <button class="btn btn-primary btn-lg" (click)="saveRequest()">
              <span class="mx-3"> Submit </span>
            </button>
          </div>
        </div>
      </cdk-step>
    </ng-stepper>
  </div>
</div>

<ng-template #RequestAutoApprovalStatus >
  <div class="modal-header">
    <h5><b>Resource Time Matrix</b></h5>
  
  </div>

  <div class="modal-body">
    <table class="table table-striped">
      <thead>
        <tr >
          <th >Type</th>
          <th style="width:20%">Resource</th>
          <th style="text-align-last: right; width:15%"><span class="text-danger">(Auto) </span> <span >From</span>&nbsp;</th>
          <th style="text-align-last: center;">To</th>
          <th style="text-align-last: center;">Status</th>
          <th style="text-align-last: right; width:18%"><span class="text-danger">(Booking) </span> <span>From</span>&nbsp;</th>
          <th style="text-align-last: center;">To</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let resource of resourceData.newData" [ngClass]="{'bold-row': resource.type === 'main'}"  >
          <td>{{capitalizeFirstLetter(resource.type) }}</td>
          <td>{{ resource.name }}</td>
         
          <td style="text-align-last: right;" >{{ resource.autoStartTime }}</td>
          <td style="text-align-last: center;">{{ resource.autoEndTime }}</td>
          <td style="text-align-last: center;">
           
            <div> <span *ngIf="resource.autoApprovalStatus === 0"> </span> </div>
            <div><span *ngIf="resource.autoApprovalStatus === 1"> <i class="fa-solid fa-a autoApproval "></i></span></div> 
            <div> <span *ngIf="resource.autoApprovalStatus === 2"> <i class="fa-solid fa-a autoApprovalDisabled "></i></span></div>
          </td>
         
          <td style="text-align-last: right;" >{{ resource.startTime }}</td>
          <td style="text-align-last: center;">{{ resource.endTime }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="modal-footer justSty">
    <div class="modal-body"></div>
    <button type="button" class="btn btn-success btn-lg text-white" (click)="closeModal()">
      Ok
    </button>
  </div>
</ng-template>

<ng-template #ResourceOwnerShip>
  <div class="modal-header">
    <h5><b>Resource Owners</b></h5>
  </div>

  <div class="modal-body">
    <div style="overflow-x: auto;">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Resource</th>
            <th>Owners</th>
          </tr>
        </thead>
      </table>
    </div>
    <div style="max-height: 300px; overflow-y: scroll;">
      <table class="table table-striped">
        <tbody>
          <tr *ngFor="let resource of resourceOwnerData | keyvalue">
            <td>{{ resource.key }}</td>
            <td>
              <ul>
                <li *ngFor="let owner of resource.value">{{ owner }}</li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="modal-footer justSty">
    <div class="modal-body"></div>
    <button type="button" class="btn btn-success btn-lg text-white" (click)="closeModal()">
      Ok
    </button>
  </div>
</ng-template>


<ng-template #GuestTimeRange>
  <div class="modal-header">
    <h5><b>Guest Time Range</b></h5>
  </div>

  <div class="modal-body">
    <table class="table ">
      <thead>
        <tr>
          <th>Guest Name</th>
          <th>Guest</th>
          <th style="text-align:center">From</th>
          <th style="text-align:center">To</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let guest of guestList;  let i = index">
          <td style="vertical-align: middle;">{{ guest.name }}</td> <!-- Replace with actual property name -->
          <td style="vertical-align: middle;">{{ guest.resourceName }}</td> <!-- Replace with actual property name -->
          <td>
            <ngb-timepicker [spinners]="false" [meridian]="false" (ngModelChange)="hasValidTimeSlots()" [(ngModel)]="fromValues[i]" ></ngb-timepicker>
          </td>
          <td>
            <ngb-timepicker [spinners]="false" [meridian]="false" (ngModelChange)="hasValidTimeSlots()" [(ngModel)]="toValues[i]" ></ngb-timepicker>
          </td>
          
          
        </tr>
      </tbody>
    </table>
  </div>
  

  <div class="modal-footer justSty">
    <div class="modal-body"></div>
    <button type="button" class="btn btn-danger btn-lg text-white" (click)="closeModal()">
      Cancel
    </button>
    <button type="button" [disabled]="!hasValidTimeSlots()" [class]="hasValidTimeSlots() ? 'btn btn-success btn-lg text-white' : 'btn btn-success btn-lg text-white disabled'" class="btn btn-success btn-lg text-white" (click)="saveGuestTimeRange()">
      Ok
    </button>
  </div>
</ng-template>

<ng-template #FileSizeExceeded let-modal5 > 
   
  <div class="modal-header textCenter" >
    <h5 class="modal-title ">Attachment Size Exceeded </h5>     
  </div>
  <div class="modal-footer justSty ">
    <div class="modal-body "  >
      <h5 style="margin-top:-20px">File is too large. Please select a file smaller than 1 MB.</h5>
    </div>
     <button type="button" class="btn btn-success btn-lg text-white " (click)="modal5.close()" >
       Ok
      </button>   
  </div>   
</ng-template>



<ngx-spinner type="ball-scale-multiple"></ngx-spinner>
